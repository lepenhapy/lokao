<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Pagamento do Relat&oacute;rio - Lok&aacute;o</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: #f4f6f8;
      color: #1f2937;
    }
    .box {
      max-width: 760px;
      margin: 48px auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }
    h1 {
      margin-top: 0;
      color: #1f3c88;
    }
    .meta {
      margin-top: 12px;
      padding: 12px;
      border: 1px solid #dbeafe;
      border-radius: 10px;
      background: #eff6ff;
      line-height: 1.5;
      font-size: 14px;
    }
    .status {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 8px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      font-weight: 600;
    }
    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    .btn {
      display: inline-block;
      text-decoration: none;
      padding: 11px 15px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
    }
    .btn-primary {
      background: #1f3c88;
      color: #fff;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .small {
      margin-top: 14px;
      font-size: 13px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="box">
    <h1>Pagamento em andamento</h1>
    <p>
      Abra o checkout, conclua o pagamento e volte para esta tela.
      A confirma&ccedil;&atilde;o &eacute; atualizada automaticamente.
    </p>

    <div class="meta">
      <strong>Produto:</strong> Relat&oacute;rio Lok&aacute;o completo<br>
      <strong>Valor:</strong> R$ 39,90<br>
      <strong>Refer&ecirc;ncia:</strong> {{ token }}
    </div>

    <div class="status" id="statusBox">Status: aguardando pagamento...</div>

    <div class="actions">
      <a class="btn btn-primary" href="{{ url_pagamento }}" target="_blank">
        Ir para pagamento
      </a>
      <a class="btn btn-secondary" href="{{ url_retorno }}">
        J&aacute; paguei
      </a>
      <a class="btn btn-secondary" href="/relatorio?token={{ token }}">
        Voltar ao relat&oacute;rio
      </a>
    </div>

    <p class="small">
      Se o status for confirmado, voc&ecirc; ser&aacute; direcionado automaticamente
      para o relat&oacute;rio liberado.
    </p>
  </div>

  <script>
    const token = "{{ token }}";
    const statusBox = document.getElementById("statusBox");

    async function checkStatus() {
      try {
        const res = await fetch(`/pagamento/status?token=${token}`);
        const data = await res.json();
        if (data.status === "pago") {
          statusBox.textContent = "Status: pagamento confirmado.";
          window.location.href = `/relatorio?token=${token}`;
          return;
        }
        statusBox.textContent = "Status: aguardando pagamento...";
      } catch (e) {
        statusBox.textContent = "Status: n&atilde;o foi poss&iacute;vel atualizar agora.";
      }
    }

    setInterval(checkStatus, 9000);
    checkStatus();
  </script>
</body>
</html>
